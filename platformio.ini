; T-Watch S3 Optimized Configuration
; PlatformIO build system for maximum performance and battery life

[env:twatch-s3]
platform = espressif32
; platform_packages = platformio/espressif32@^6.3.0
board = esp32-s3-devkitc-1
framework = arduino

# OPTIMIZED BUILD FLAGS FOR MAX PERFORMANCE
build_flags = 
    ; Size optimizations
    -Os
    -DCORE_DEBUG_LEVEL=0
    -DNDEBUG
    
    ; Linker optimizations
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections
    
    ; CPU optimization
    ; -march=esp32s3  ; Not supported by this toolchain
    ; -mtune=esp32s3   ; Not supported by this toolchain
    
    ; Memory optimizations
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    
    ; LVGL Optimizations (Reduced from 200KB to 80KB)
    -DLV_CONF_INCLUDE_SIMPLE
    -DLV_COLOR_DEPTH=8              ; 8-bit color (saves 50% memory)
    -DLV_DISP_DEF_REFR_PERIOD=30   ; 30Hz refresh (saves power)
    -DLV_MEM_CUSTOM=1
    -DLV_MEM_POOL_EXP=1
    
    ; Disable unused LVGL widgets (saves ~100KB)
    -DLV_USE_ARC=0
    -DLV_USE_BAR=0
    -DLV_USE_BUTTON=1
    -DLV_USE_CALENDAR=0
    -DLV_USE_CANVAS=1
    -DLV_USE_CHART=0
    -DLV_USE_CHECKBOX=0
    -DLV_USE_COLORWHEEL=0
    -DLV_USE_DROPDOWN=0
    -DLV_USE_IMG=1
    -DLV_USE_KEYBOARD=0
    -DLV_USE_LABEL=1
    -DLV_USE_LINE=0
    -DLV_USE_LIST=0
    -DLV_USE_MENU=0
    -DLV_USE_METER=0
    -DLV_USE_MSGBOX=0
    -DLV_USE_ROLLER=0
    -DLV_USE_SLIDER=0
    -DLV_USE_SPINBOX=0
    -DLV_USE_SPINNER=0
    -DLV_USE_SWITCH=0
    -DLV_USE_TEXTAREA=1
    -DLV_USE_TILEVIEW=1
    -DLV_USE_WIN=0
    
    ; Font optimizations (Keep only essential fonts for clock faces)
    -DLV_FONT_MONTSERRAT_12=1
    -DLV_FONT_MONTSERRAT_16=1
    -DLV_FONT_MONTSERRAT_18=1
    -DLV_FONT_MONTSERRAT_20=1
    -DLV_FONT_MONTSERRAT_24=1
    -DLV_FONT_MONTSERRAT_48=1
    -DLV_FONT_MONTSERRAT_72=1
    -DLV_FONT_MONTSERRAT_16=1
    -DLV_FONT_DEFAULT=lv_font_montserrat_16
    
    ; Power optimizations
    -DUSING_TWATCH_S3
    -DDISABLE_ALL_LIBRARY_WARNINGS

# OPTIMIZED LIBRARY DEPENDENCIES (Reduced from 15 to 6)
lib_deps = 
    ; Core libraries
    lovyan03/LovyanGFX@^1.1.8
    lvgl/lvgl@^8.3.11
    
    ; Power management
    lewisxhe/XPowersLib@^0.2.4
    
    ; Sensors
    lewisxhe/SensorLib@^0.1.8
    
    ; Audio (Minimal)
    arduinoFFT@^1.6

# OPTIMIZED PARTITIONS (3MB App, 9MB Storage)
board_build.partitions = partitions_3M_9M.csv

# FLASH CONFIGURATION
board_build.firmware = firmware
board_build.flash_mode = qio
board_build.f_speed = 80000000L

# MONITOR CONFIGURATION
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    default

# UPLOAD CONFIGURATION
upload_speed = 921600
upload_protocol = esptool

# BUILD CONFIGURATION
build_unflags = 
    -std=gnu++11
build_src_filter = 
    +<src/>
    -<src/examples/>

# OPTIMIZATION PROFILES
[env:twatch-s3-debug]
extends = env:twatch-s3
build_flags = 
    ${env:twatch-s3.build_flags}
    -O0
    -g3
    -DCORE_DEBUG_LEVEL=3
    -DDEBUG_ESP_PORT=Serial

[env:twatch-s3-minimal]
extends = env:twatch-s3
build_flags = 
    ${env:twatch-s3.build_flags}
    -Os
    -DLV_USE_LOG=0
    -DLV_USE_ASSERT=0
    -DLV_USE_CHECK_VERSION=0
    -DCORE_DEBUG_LEVEL=0

[env:twatch-s3-production]
extends = env:twatch-s3
build_flags = 
    ${env:twatch-s3.build_flags}
    -Os
    -flto
    -DCORE_DEBUG_LEVEL=0
    -DNDEBUG
    -DARDUINO_NO_WARNING_WRITE_STRINGS